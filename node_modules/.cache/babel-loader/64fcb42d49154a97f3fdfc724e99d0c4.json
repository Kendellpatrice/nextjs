{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _extends from \"@babel/runtime-corejs2/helpers/esm/extends\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar _jsxFileName = \"/Users/bas/Documents/Workspace/TWE_POC/nextjs/pages/index.js\";\nimport React from \"react\";\nimport Layout from '../components/mylayout.js';\nimport Banner from '../components/banner.js';\nimport Image from '../components/image.js';\nimport SimpleText from '../components/simpletext.js';\nimport RichTextField from '../components/richtextfield.js';\nimport fetch from 'isomorphic-unfetch';\nimport Link from \"next/link\";\nimport Head from 'next/head';\nimport TwoColumn from '../components/twocolumn/layout.js';\n\nvar Dyn =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(Dyn, _React$Component);\n\n  function Dyn() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, Dyn);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(Dyn)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_this), \"mapTypeToComponent\", function (typeName, componentProps, image, siteLanguage, componentList) {\n      componentProps.siteLanguage = siteLanguage;\n\n      switch (typeName) {\n        case 'https://raw.githubusercontent.com/janxl/nextjs/master/schemas/image.json':\n          return React.createElement(Image, _extends({}, componentProps, {\n            image: image,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 79\n            },\n            __self: this\n          }));\n\n        case 'https://raw.githubusercontent.com/janxl/nextjs/master/schemas/banner.json':\n          return React.createElement(Banner, _extends({}, componentProps, {\n            image: image,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 81\n            },\n            __self: this\n          }));\n\n        case 'https://raw.githubusercontent.com/janxl/nextjs/master/schemas/simpletextblock.json':\n          return React.createElement(SimpleText, _extends({}, componentProps, {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 83\n            },\n            __self: this\n          }));\n\n        case 'https://raw.githubusercontent.com/janxl/nextjs/master/schemas/richtextfield.json':\n          return React.createElement(RichTextField, _extends({}, componentProps, {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 85\n            },\n            __self: this\n          }));\n\n        case 'https://raw.githubusercontent.com/janxl/nextjs/master/schemas/twocolumncontainer.json':\n          return React.createElement(TwoColumn, _extends({}, componentProps, {\n            componentList: componentList,\n            siteLanguage: siteLanguage,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 87\n            },\n            __self: this\n          }));\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getComponentProps\", function (componentId, componentList) {\n      return componentList.find(function (item) {\n        return item['@id'] === componentId;\n      });\n    });\n\n    return _this;\n  }\n\n  _createClass(Dyn, [{\n    key: \"getGuidFromId\",\n    value: function getGuidFromId(componentId) {\n      if (componentId.length >= 0) {\n        var parts = componentId.split('/');\n\n        if (parts.length >= 0) {\n          return parts[parts.length - 1];\n        }\n      }\n\n      return '';\n    }\n  }, {\n    key: \"getMenu\",\n    value: function getMenu(menuComponentList, siteName) {\n      var _this2 = this;\n\n      var url = this.props.url;\n\n      if (menuComponentList[0].slugs != null) {\n        return React.createElement(React.Fragment, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 131\n          },\n          __self: this\n        }, menuComponentList[0].slugs.map(function (item, index) {\n          var componentProps = _this2.getComponentProps(item['@id'], menuComponentList);\n\n          var pageId = _this2.getGuidFromId(componentProps.page['@id']);\n\n          var navUrl = \"/index?site=\".concat(siteName, \"&id=\").concat(pageId);\n          var customRoute = navUrl;\n          return React.createElement(Link, {\n            prefetch: true,\n            href: customRoute,\n            as: componentProps.slug,\n            key: \"key-\".concat(index),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 140\n            },\n            __self: this\n          }, React.createElement(\"a\", {\n            className: \"c-nav__item \".concat(url.asPath === customRoute ? 'active' : ''),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 141\n            },\n            __self: this\n          }, componentProps.navLabel != null ? componentProps.navLabel.values[0].value : ''));\n        }));\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var _this$props = this.props,\n          data = _this$props.data,\n          dataMenu = _this$props.dataMenu,\n          siteLanguage = _this$props.siteLanguage,\n          siteName = _this$props.siteName;\n      var componentList = data['@graph'];\n      var menuComponentList = dataMenu['@graph'];\n      var imageList = componentList.filter(function (item) {\n        return item.mediaType === 'image';\n      });\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 155\n        },\n        __self: this\n      }, React.createElement(Head, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 156\n        },\n        __self: this\n      }, React.createElement(\"title\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 157\n        },\n        __self: this\n      }, \"Treasure Wine Estates - \", siteName), React.createElement(\"link\", {\n        rel: \"stylesheet\",\n        href: \"https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css\",\n        integrity: \"sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T\",\n        crossOrigin: \"anonymous\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 158\n        },\n        __self: this\n      }), React.createElement(\"link\", {\n        rel: \"stylesheet\",\n        href: \"../static/styles/\".concat(siteName, \"/styles.css\"),\n        crossOrigin: \"anonymous\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 159\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: \"c-site-wrapper\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 161\n        },\n        __self: this\n      }, React.createElement(\"nav\", {\n        className: \"nav\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 162\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"c-nav\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 163\n        },\n        __self: this\n      }, this.getMenu(menuComponentList, siteName))), React.createElement(Layout, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 169\n        },\n        __self: this\n      }, componentList[0] && componentList[0].slotContent ? componentList[0].slotContent.map(function (item, index) {\n        var image = null;\n\n        var componentProps = _this3.getComponentProps(item['@id'], componentList);\n\n        if (componentProps.background || componentProps.image) {\n          image = imageList.find(function (imageItem) {\n            return componentProps.background && imageItem['@id'] === componentProps.background['@id'] || componentProps.image && imageItem['@id'] === componentProps.image['@id'];\n          });\n        }\n\n        return React.createElement(\"div\", {\n          key: \"key-\".concat(index),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 178\n          },\n          __self: this\n        }, _this3.mapTypeToComponent(item['@type'], componentProps, image, siteLanguage, componentList));\n      }) : null)));\n    }\n  }], [{\n    key: \"getInitialProps\",\n    value: function () {\n      var _getInitialProps = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(_ref) {\n        var _this4 = this;\n\n        var pathname, query, req, page, siteLanguage, urlId, siteName, routes, siteId, treeRootUrl, slugId, dataMenu, pageId, url, res, data;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                pathname = _ref.pathname, query = _ref.query, req = _ref.req;\n                // Set the site language with a default of English\n                page = '';\n                siteLanguage = query.lang != null ? query.lang : 'en-AU';\n                urlId = query.id != null ? query.id : '';\n                siteName = query.site != null ? query.site : '';\n                routes = require('next-routes');\n                console.log(query);\n                console.log('entry');\n                if (query.page != '/') page = '/' + query.page;\n                if (page == '/undefined') page = '/'; // Get Site Id / Name\n\n                siteId = '';\n                _context.t0 = siteName;\n                _context.next = _context.t0 === 'ativo' ? 14 : 17;\n                break;\n\n              case 14:\n                siteName = 'ativo';\n                siteId = '99757712-7a28-4ce5-94f3-82c2f936cbc6';\n                return _context.abrupt(\"break\", 20);\n\n              case 17:\n                siteName = 'squealingpig';\n                siteId = 'e904f0cd-7f15-4773-807a-f35f322b18e8';\n                return _context.abrupt(\"break\", 20);\n\n              case 20:\n                // Url for Root of CMS Tree, returning all nodes\n                treeRootUrl = \"https://c1.adis.ws/cms/content/query?query=%7b%22sys.iri%22:%22http://content.cms.amplience.net/\".concat(siteId, \"%22%7d&scope=tree&store=twe&fullBodyObject=true\"); // Get route from Data\n\n                slugId = '';\n                dataMenu = '';\n                _context.next = 25;\n                return fetch(treeRootUrl).then(function (response) {\n                  return response.json();\n                }).then(function (json) {\n                  slugId = _this4.getCustomRoute(json, page);\n                  dataMenu = json;\n                });\n\n              case 25:\n                pageId = '';\n                if (urlId != '') pageId = urlId;else if (slugId != '') pageId = slugId;else pageId = siteId;\n                url = \"https://c1.adis.ws/cms/content/query?query=%7b%22sys.iri%22:%22http://content.cms.amplience.net/\".concat(pageId, \"%22%7d&scope=tree&store=twe&fullBodyObject=true\");\n                _context.next = 30;\n                return fetch(url);\n\n              case 30:\n                res = _context.sent;\n                _context.next = 33;\n                return res.json();\n\n              case 33:\n                data = _context.sent;\n                return _context.abrupt(\"return\", {\n                  data: data,\n                  dataMenu: dataMenu,\n                  siteName: siteName,\n                  siteLanguage: siteLanguage,\n                  page: page\n                });\n\n              case 35:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      function getInitialProps(_x) {\n        return _getInitialProps.apply(this, arguments);\n      }\n\n      return getInitialProps;\n    }()\n  }]);\n\n  return Dyn;\n}(React.Component);\n\n_defineProperty(Dyn, \"getCustomRoute\", function (data, path) {\n  if (path == null || path == '') path = '/';\n  var componentList = data['@graph'];\n  var componentProps = componentList.find(function (item) {\n    return item['slug'] === path;\n  });\n\n  if (componentProps != null) {\n    var componentId = componentProps.page['@id'];\n\n    if (componentId.length >= 0) {\n      var parts = componentId.split('/');\n\n      if (parts.length >= 0) {\n        return parts[parts.length - 1];\n      }\n    }\n  }\n\n  return '';\n});\n\nexport { Dyn as default };","map":{"version":3,"sources":["/Users/bas/Documents/Workspace/TWE_POC/nextjs/pages/index.js"],"names":["Layout","Banner","Image","SimpleText","RichTextField","fetch","Link","Head","TwoColumn","Dyn","typeName","componentProps","image","siteLanguage","componentList","componentId","find","item","length","parts","split","menuComponentList","siteName","url","props","slugs","map","index","getComponentProps","pageId","getGuidFromId","page","navUrl","customRoute","slug","asPath","navLabel","values","value","data","dataMenu","imageList","filter","mediaType","getMenu","slotContent","background","imageItem","mapTypeToComponent","pathname","query","req","lang","urlId","id","site","routes","require","console","log","siteId","treeRootUrl","slugId","then","response","json","getCustomRoute","res","React","Component","path"],"mappings":"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","sourcesContent":["import Layout from '../components/mylayout.js'\nimport Banner from '../components/banner.js'\nimport Image from '../components/image.js'\nimport SimpleText from '../components/simpletext.js'\nimport RichTextField from '../components/richtextfield.js'\nimport fetch from 'isomorphic-unfetch'\nimport Link from \"next/link\"\nimport Head from 'next/head'\nimport TwoColumn from '../components/twocolumn/layout.js'\n\nexport default class Dyn extends React.Component {\n  \n  static async getInitialProps({ pathname, query, req }) {\n    // Set the site language with a default of English\n    let page = ''\n    let siteLanguage = query.lang != null ? query.lang : 'en-AU';\n    let urlId = query.id != null ? query.id : '';\n    let siteName = query.site != null ? query.site : '';\n    \n    const routes = require('next-routes')\n\n    console.log(query)\n\n    console.log('entry')\n\n    if (query.page != '/')\n      page = '/' + query.page;\n\n    if (page == '/undefined')\n      page = '/'\n\n    // Get Site Id / Name\n    var siteId = ''\n    switch (siteName) {\n      case 'ativo':\n        siteName = 'ativo'\n        siteId = '99757712-7a28-4ce5-94f3-82c2f936cbc6'\n        break;\n      default:\n        siteName = 'squealingpig'\n        siteId = 'e904f0cd-7f15-4773-807a-f35f322b18e8'\n        break;\n    }\n    \n    // Url for Root of CMS Tree, returning all nodes\n    const treeRootUrl = `https://c1.adis.ws/cms/content/query?query=%7b%22sys.iri%22:%22http://content.cms.amplience.net/${siteId}%22%7d&scope=tree&store=twe&fullBodyObject=true`\n    \n    // Get route from Data\n    var slugId = '';\n    var dataMenu = ''\n    await fetch(treeRootUrl)\n      .then(response => response.json())\n      .then(json => {\n        slugId = this.getCustomRoute(json, page)\n        dataMenu = json\n      })\n    \n    var pageId = ''\n    if(urlId!='')\n      pageId = urlId\n    else if(slugId!='')  \n      pageId = slugId\n    else \n      pageId = siteId\n    \n    const url = `https://c1.adis.ws/cms/content/query?query=%7b%22sys.iri%22:%22http://content.cms.amplience.net/${pageId}%22%7d&scope=tree&store=twe&fullBodyObject=true`\n    \n    const res = await fetch(url)\n    const data = await res.json()\n\n    return { data, dataMenu, siteName, siteLanguage, page }\n  }  \n\n  mapTypeToComponent = (typeName, componentProps, image, siteLanguage, componentList) => {\n    componentProps.siteLanguage = siteLanguage\n\n    switch(typeName) {\n      case 'https://raw.githubusercontent.com/janxl/nextjs/master/schemas/image.json':\n        return <Image {...componentProps} image={image} />\n      case 'https://raw.githubusercontent.com/janxl/nextjs/master/schemas/banner.json':\n        return <Banner {...componentProps} image={image} />\n      case 'https://raw.githubusercontent.com/janxl/nextjs/master/schemas/simpletextblock.json':\n        return  <SimpleText {...componentProps} />\n      case 'https://raw.githubusercontent.com/janxl/nextjs/master/schemas/richtextfield.json':\n        return <RichTextField {...componentProps} />\n      case 'https://raw.githubusercontent.com/janxl/nextjs/master/schemas/twocolumncontainer.json':\n        return <TwoColumn {...componentProps} componentList={componentList} siteLanguage={siteLanguage} />\n    }\n  }\n\n  // This method gets custom routes by looking up the nav path and finding the id\n  static getCustomRoute = (data, path) => {\n    if (path == null || path == '')\n      path = '/'\n\n    let componentList = data['@graph']\n    const componentProps = componentList.find((item) => item['slug'] === path)\n    \n    if (componentProps != null){\n      let componentId = componentProps.page['@id']\n      if (componentId.length >= 0){\n        let parts = componentId.split('/')\n        if (parts.length >= 0){\n          return parts[parts.length - 1]\n        }\n      }\n    }\n    return ''\n  }\n\n  getComponentProps = (componentId, componentList) => {\n    return componentList.find((item) => item['@id'] === componentId)\n  }\n\n  getGuidFromId(componentId){\n    if (componentId.length >= 0){\n      let parts = componentId.split('/')\n      \n      if (parts.length >= 0){\n        return parts[parts.length - 1]\n      }\n    }\n    return ''\n  }\n\n  getMenu(menuComponentList, siteName){\n    const { url } = this.props\n\n    if (menuComponentList[0].slugs != null ){\n\n      return <React.Fragment>\n      {\n        menuComponentList[0].slugs.map((item, index) => {\n          const componentProps = this.getComponentProps(item['@id'], menuComponentList)\n          \n          let pageId = this.getGuidFromId(componentProps.page['@id'])\n          let navUrl = `/index?site=${siteName}&id=${pageId}`\n          let customRoute = navUrl\n          \n          return <Link prefetch href={customRoute} as={componentProps.slug} key={`key-${index}`}>\n            <a className={`c-nav__item ${url.asPath === customRoute ? 'active' : ''}`}>{componentProps.navLabel != null ? componentProps.navLabel.values[0].value : ''}</a>\n          </Link>\n        }\n      )}</React.Fragment>\n    }\n  }\n\n  render() {\n    const { data, dataMenu, siteLanguage, siteName } = this.props\n    const componentList = data['@graph']\n    const menuComponentList = dataMenu['@graph']\n    const imageList = componentList.filter((item) => item.mediaType === 'image')\n    \n    return (\n      <div>\n        <Head>\n          <title>Treasure Wine Estates - {siteName}</title>\n          <link rel=\"stylesheet\" href=\"https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css\" integrity=\"sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T\" crossOrigin=\"anonymous\" />\n          <link rel=\"stylesheet\" href={`../static/styles/${siteName}/styles.css`} crossOrigin=\"anonymous\" />\n        </Head>\n        <div className='c-site-wrapper'>\n          <nav className='nav'>\n            <div className=\"c-nav\">\n              {\n                this.getMenu(menuComponentList, siteName)\n              }\n            </div>\n          </nav>\n          <Layout>\n            { componentList[0] && componentList[0].slotContent ? componentList[0].slotContent.map((item, index) => {\n                let image = null\n                const componentProps = this.getComponentProps(item['@id'], componentList)\n\n                if (componentProps.background || componentProps.image) {\n                  image = imageList.find((imageItem) => (componentProps.background && imageItem['@id'] === componentProps.background['@id']) || (componentProps.image && imageItem['@id'] === componentProps.image['@id']))\n                }\n\n                return <div key={`key-${index}`}>\n                  {this.mapTypeToComponent(item['@type'], componentProps, image, siteLanguage, componentList)}\n                </div>\n            }) : null}\n          </Layout>\n        </div>\n      </div>\n    )\n  }\n}"]},"metadata":{},"sourceType":"module"}